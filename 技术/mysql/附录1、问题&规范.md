#### 1、对阿里巴巴Java开发手册，超过3张表禁止join的理解

对超过3张表的join，会对索引以及SQL的优化带来困难，而且执行这样的复杂查询，会影响数据库的效率。一些对数据的关联计算等操作应该交给应用程序去完成，即便交给数据库去完成可能更快，也不应该这么做，因为数据库的职责是提供数据存储和查询，而不是做这些复杂的关联计算。



#### 2、MVCC&一致性非锁定读

一致性非锁定读指读取数据没时有加锁，MVCC与一致性非锁定读，能够提升数据库性能，并使得事务中每次读取相同的数据，数据都是一致的。由于MVCC与一致性非锁定读，使得即便有其他事务给数据加上了写锁，当前事务也无需等待写锁，而是直接读取快照。

每个读写事务，都有与之对应的回滚段，使得回滚事务时，能够回到数据更新前的状态。回滚段包含了3个系统隐藏字段: 事务ID、回滚指针、行ID。事务ID指最新对这条数据进行更新的事务ID；行ID指数据的唯一标识，如果有主键，这里的ID便是主键，否则就是某个唯一索引，如果都没有，系统会创建一个额外的唯一序列作行ID。

MVCC对聚簇索引是原地更新，对二级索引不是原地更新，先将原索引记录标记为删除，并新增索引记录。当使用二级索引进行检索时，从索引中找到聚簇索引，再根据聚簇索引找到正确版本的记录。需要注意的事，当覆盖索引被更新，此时覆盖索引会失效，根据检索出的聚簇索引回表检索正确版本的数据。



#### 3、两阶段提交

两阶段提交是指事务提交时，会做如下操作:

1. 写入redo log日志，处于prepare状态；
2. 写入bin log日志；
3. 提交事务，redo log处于commit状态。

这样做是为了防止数据状态和bin log不一致，如果不做两阶段提交，当系统崩溃时，存在以下两种情况:

- 先写redo log后写bin log，如果redo log已经写入，而bin log还没有写入，当主从同步或者拿bin log进行数据恢复，则会比实际少一次更新；
- 先写bin log后写redo log，如果bin log已经写入，而redo log还没有写入，当主从同步或者拿bin log进行数据恢复，则会比实际多一次更新。

有了两阶段提交，系统重启时，系统能够根据redo log和bin log自动进行恢复，系统能够将redo log和bin log进行对应，是因为它们有一个共同的字段XID，系统根据这个XID将redo log和bin log进行关联。

