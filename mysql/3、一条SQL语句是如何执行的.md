#### Server层

- 连接器（管理连接，权限验证）
- 查询缓存（命中则直接返回结果，不建议使用，弊大于利，8.0版本已删除整块功能）
- 分析器（词法法分析、语法分析）
- 优化器（执行计划生成，索引选择）
- 执行器（操作引擎，返回结果）



#### 存储引擎层

存储引擎层负责数据的存储和读取。其架构模式是插件式的，支持InnoDB、MyISAM、Memory等多个存储引擎。现在最常用的存储引擎是InnoDB，它从MySQL5.5.5版本开始成为了默认存储引擎。也就是说如果我们在create table时不指定表的存储引擎，默认会给你设置存储引擎为InnoDB。



#### 连接器

一个用户成功建立连接后，就是你用管理员账号对这个用户的权限做了修改，也不会影响已经存在连接的权限。修改完成后，只有再新建的连接才会使用新的权限设置。用户的权限表在系统表空间的mysql的user表中。

长连接累积下来，可能导致内存占用太大，被系统强行杀掉（OOM），从现象看就是MySQL异常重启了，怎么解决这类问题？

1. 定期断开长连接，使用一段时间，或者程序里面判断执行过一个占用内存的大查询后，断开连接，之后要查询再重连；
2. 如果你使用的事MySQL5.7或更新版本，可以在每次执行一个比较大的操作后，通过执行mysql_reset_connection来重新初始化连接资源。这个过程不需要重连或重新做权限验证，到那时会将连接恢复到刚刚创建完时的状态。



#### 分析器

**词法分析：**识别关键字。

**语法分析：**根据词法分析的结果，语法分析器会根据语法规则，判断你输入的这个SQL语句是否满足MySQL语法。



#### 优化器

- 决定使用哪个索引；
- 决定各个表的连接顺序。



#### 执行器

- 判断用户对表的执行权限；
- 打开表，根据表的引擎定义，去使用这个引擎提供的接口。



#### binlog

1. binlog在MySQL的server层实现（引擎共用）；
2. binlog为逻辑日志，记录的事一条语句的原始逻辑；
3. binlog不限大小，追加写入，不会覆盖以前的日志。

